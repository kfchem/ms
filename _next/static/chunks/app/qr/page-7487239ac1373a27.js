(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[128],{2119:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>E});var a=r(5155),n=r(2115),l=r(1023),s=r(5070),i=r(9648),o=r(1210),d=r(2993),u=r(9622),c=r(3591),m=r(7871),h=r(8285);let p=e=>{var t;return{atoms:e.atoms.map(e=>({symbol:e[0],x:e[1],y:e[2],z:e[3],..."number"==typeof e[4]?{charge:e[4]}:{}})),bonds:e.bonds.map(e=>{var t;return{i:e[0],j:e[1],order:null!=(t=e[2])?t:1}}),title:null==(t=e.meta)?void 0:t.title}},g=async(e,t)=>{var r,a,n;let l,s,i;try{l=(0,d.U)(e)}catch(e){throw Error("Invalid Base80 segment")}if(l.byteLength<3)throw Error("Invalid segment");let g=String.fromCharCode(l[0],l[1]),f=l[2];if("MS"!==g||1!=(f>>>4&15)||(15&f&1)==0)throw Error("Not an encrypted MS v1 segment");if(l.byteLength<47)throw Error("Encrypted segment too short");let x=l.subarray(3,19),v=l.subarray(19,31),b=l.subarray(31),w=await (0,h.XG)(t,x,1e5);try{s=await (0,h.sQ)(w,v,b)}catch(e){if(e&&"OperationError"===e.name)throw Error("Wrong password or data corrupted");throw e}let y=new Uint8Array((0,o.UD)(s)),j=new u.V(y),U=j.readUnsigned(10),k=j.readUnsigned(12),E=j.readUnsigned(2),N=8+j.readUnsigned(4),S=j.readUnsigned(2),R=j.readUnsigned(6),M=j.readUnsigned(6),L=j.readUnsigned(2),C=j.readUnsigned(1),A=j.readUnsigned(1),O=j.readUnsigned(7),P=[];for(let e=0;e<O;e+=1)P.push(j.readUnsigned(7));let T=Math.max(1,Math.ceil(Math.log2(Math.max(1,O)))),z=Math.max(1,Math.ceil(Math.log2(Math.max(1,U)))),q=1<<E;try{let e=j.readUnsigned(1);if(1===e){let e=j.readUnsigned(6),t=(()=>{let e=[" ","-"];for(let t=0;t<10;t++)e.push(String(t));for(let t=0;t<26;t++)e.push(String.fromCharCode(65+t));for(let t=0;t<26;t++)e.push(String.fromCharCode(97+t));return e})(),a=[];for(let n=0;n<e;n++)a.push(null!=(r=t[j.readUnsigned(6)])?r:"-");i=a.join("").trim()}}catch(e){}let W=[],B=0,D=0,H=0;for(let e=0;e<U;e+=1){let t=null!=(a=P[j.readUnsigned(T)])?a:6,r=j.readSigned(N),n=j.readSigned(N),l=j.readSigned(N);0===e||0===C?(B=r,D=n,H=l):(B+=r,D+=n,H+=l),W.push([(0,c.$)(t),B/1e3*q,D/1e3*q,H/1e3*q])}let _=[];if(1===A)_=(0,m.a)(W.map(e=>({symbol:e[0],x:e[1],y:e[2],z:e[3]}))).map(e=>[e.i,e.j,e.order]);else for(let e=0;e<k;e+=1){let e=j.readUnsigned(z),t=j.readUnsigned(z),r=j.readUnsigned(2),a=1===r?1:2===r?2:3;_.push([e,t,a])}let F={material:null!=(n=({0:"standard",1:"metal",2:"toon",3:"glass"})[S])?n:"standard",atomScale:.02*R,bondRadius:.02*M,quality:0===L?"low":1===L?"medium":2===L?"high":"ultra"},I={v:2,atoms:W,bonds:_,style:F,meta:i?{title:i}:void 0};return{payload:I,molecule:p(I),style:F}};var f=r(3909),x=r(874);let v=n.forwardRef(function(e,t){let{title:r,titleId:a,...l}=e;return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},l),r?n.createElement("title",{id:a},r):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"}))}),b=n.forwardRef(function(e,t){let{title:r,titleId:a,...l}=e;return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},l),r?n.createElement("title",{id:a},r):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"}))}),w=n.forwardRef(function(e,t){let{title:r,titleId:a,...l}=e;return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},l),r?n.createElement("title",{id:a},r):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75"}))}),y=n.forwardRef(function(e,t){let{title:r,titleId:a,...l}=e;return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},l),r?n.createElement("title",{id:a},r):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 7.5-9-5.25L3 7.5m18 0-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9"}))});var j=r(1408),U=r(4486);let k={material:"standard",atomScale:.28,bondRadius:.09,quality:"medium"},E=()=>{var e,t;let[h,E]=(0,n.useState)(!0),[N,S]=(0,n.useState)(null),[R,M]=(0,n.useState)(null),[L,C]=(0,n.useState)(k),[A,O]=(0,n.useState)(null),[P,T]=(0,n.useState)(!1),z=(0,n.useRef)(null),q=(0,n.useRef)(null),[W,B]=(0,n.useState)(null),[D,H]=(0,n.useState)(""),[_,F]=(0,n.useState)(!1),[I,Q]=(0,n.useState)(null),[G,V]=(0,n.useState)(!1),X="undefined"!=typeof globalThis&&globalThis.crypto&&globalThis.crypto.subtle;(0,n.useMemo)(()=>{if(h)return"Decoding shared payload...";if(N||!R)return i.FY;let e=[];return R.title&&e.push(R.title),e.push("".concat(R.atoms.length," atoms")),e.join(" | ")},[N,h,R]);let $=(0,n.useCallback)(e=>{if("undefined"==typeof document)return;let t=e&&e.trim().length>0?"".concat(e):"".concat(i.C3);document.title=t},[]),K=(0,n.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:220,r=window.setTimeout(()=>$(null!=e?e:null),Math.max(0,t));return()=>window.clearTimeout(r)},[$]);(0,n.useEffect)(()=>{var e;let t=K(null!=(e=null==R?void 0:R.title)?e:null,220);return()=>{"function"==typeof t&&t()}},[K,null==R?void 0:R.title]),(0,n.useEffect)(()=>{let e=()=>{let e=window.location.hash,t=e.startsWith("#")?e.slice(1):e;if(!t){S("Missing payload in URL hash. Expected /qr#<payload>."),M(null),E(!1);return}try{var r;let e=(e=>{let t;try{t=(0,d.U)(e)}catch(e){throw Error("Invalid Base80 segment")}if(t.byteLength>=3){let e=String.fromCharCode(t[0],t[1]),l=t[2];if("MS"===e&&1==(l>>>4&15)){if((15&l&1)!=0)throw Error("Encrypted MS segment: password required");{var r,a,n;let e,l=new Uint8Array((0,o.UD)(t.subarray(3))),s=new u.V(l),i=s.readUnsigned(10),d=s.readUnsigned(12),h=s.readUnsigned(2),g=8+s.readUnsigned(4),f=s.readUnsigned(2),x=s.readUnsigned(6),v=s.readUnsigned(6),b=s.readUnsigned(2),w=s.readUnsigned(1),y=s.readUnsigned(1),j=s.readUnsigned(7),U=[];for(let e=0;e<j;e+=1)U.push(s.readUnsigned(7));let k=Math.max(1,Math.ceil(Math.log2(Math.max(1,j)))),E=Math.max(1,Math.ceil(Math.log2(Math.max(1,i)))),N=1<<h;try{let t=s.readUnsigned(1);if(1===t){let t=s.readUnsigned(6),a=(()=>{let e=[" ","-"];for(let t=0;t<10;t++)e.push(String(t));for(let t=0;t<26;t++)e.push(String.fromCharCode(65+t));for(let t=0;t<26;t++)e.push(String.fromCharCode(97+t));return e})(),n=[];for(let e=0;e<t;e++)n.push(null!=(r=a[s.readUnsigned(6)])?r:"-");e=n.join("").trim()}}catch(e){}let S=[],R=0,M=0,L=0;for(let e=0;e<i;e+=1){let t=null!=(a=U[s.readUnsigned(k)])?a:6,r=s.readSigned(g),n=s.readSigned(g),l=s.readSigned(g);0===e||0===w?(R=r,M=n,L=l):(R+=r,M+=n,L+=l),S.push([(0,c.$)(t),R/1e3*N,M/1e3*N,L/1e3*N])}let C=[];if(1===y)C=(0,m.a)(S.map(e=>({symbol:e[0],x:e[1],y:e[2],z:e[3]}))).map(e=>[e.i,e.j,e.order]);else for(let e=0;e<d;e+=1){let e=s.readUnsigned(E),t=s.readUnsigned(E),r=s.readUnsigned(2),a=1===r?1:2===r?2:3;C.push([e,t,a])}let A={material:null!=(n=({0:"standard",1:"metal",2:"toon",3:"glass"})[f])?n:"standard",atomScale:.02*x,bondRadius:.02*v,quality:0===b?"low":1===b?"medium":2===b?"high":"ultra"},O={v:2,atoms:S,bonds:C,style:A,meta:e?{title:e}:void 0};return{payload:O,molecule:p(O),style:A}}}}throw Error("Unsupported segment: MS v1 only")})(t);K(null!=(r=e.molecule.title)?r:null,220),M(e.molecule),C({...e.style}),S(null)}catch(r){let e=(null==r?void 0:r.message)||"";/password required/i.test(e)?(B(t),S(null)):(console.error(r),S("Invalid or corrupted QR payload. Please request a new QR code.")),M(null)}finally{E(!1)}};return e(),window.addEventListener("hashchange",e),()=>window.removeEventListener("hashchange",e)},[K]);let[Y,J]=(0,n.useState)(null),[Z,ee]=(0,n.useState)(null),[et,er]=(0,n.useState)(null),[ea,en]=(0,n.useState)(!1),[el,es]=(0,n.useState)(!1),ei=(0,n.useRef)(null);(0,n.useEffect)(()=>()=>{Y&&URL.revokeObjectURL(Y.url),Z&&URL.revokeObjectURL(Z.url)},[Y,Z]);let eo=(0,n.useCallback)(async()=>{if(!A)return null;try{Y&&URL.revokeObjectURL(Y.url),Z&&URL.revokeObjectURL(Z.url);let[{prepareSceneForExport:e},{exportGlb:t},{exportUsdz:a}]=await Promise.all([r.e(171).then(r.bind(r,4171)),r.e(847).then(r.bind(r,6847)),r.e(866).then(r.bind(r,2866))]),n=e(A),l=await t(n),s=URL.createObjectURL(l),i={url:s,size:l.size};J(i);let o=await a(n),d=URL.createObjectURL(o),u={url:d,size:o.size};if(ee(u),ei.current)try{ei.current.setAttribute("src",s),ei.current.setAttribute("ios-src",d)}catch(e){}return{glb:i,usdz:u}}catch(e){return console.error(e),er(e.message||"Failed to prepare model"),null}},[Y,Z,A]),ed=(0,n.useCallback)(async()=>{if(!A)return;let e="undefined"!=typeof navigator&&/iPad|iPhone|iPod/.test(navigator.userAgent);try{var t;er(null),en(!0),e||el||es(!0);let r=await eo();if(!r)throw Error("Failed to build AR artifacts");if(e){let e=r.usdz.url,t=document.createElement("a");t.setAttribute("rel","ar"),t.href=e,document.body.append(t),t.click(),setTimeout(()=>t.remove(),0);return}let a=ei.current;if(!a)throw Error("AR viewer not ready");if(a.setAttribute("src",r.glb.url),a.setAttribute("ios-src",r.usdz.url),void 0!==a.canActivateAR&&!1===a.canActivateAR)return void er("AR is not supported on this device.");null==(t=a.activateAR)||t.call(a)}catch(e){console.error(e),er(e.message||"Failed to open AR")}finally{en(!1)}},[eo,A,el]);(0,n.useEffect)(()=>{(async()=>{try{customElements.get("model-viewer")||await Promise.all([r.e(375),r.e(457),r.e(131)]).then(r.bind(r,4131))}catch(e){}})()},[]),(0,n.useEffect)(()=>{let e=e=>{var t,r;if(!P)return;let a=e.target;(null==(t=z.current)||!t.contains(a))&&(null!=(r=q.current)&&r.contains(a)||T(!1))},t=e=>{"Escape"===e.key&&T(!1)};return document.addEventListener("mousedown",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",t)}},[P]);let eu=(0,n.useCallback)(async()=>{if(!W)return;let e=D.trim();if(e.length<4){Q("Enter at least 4 characters"),V(!0),setTimeout(()=>V(!1),350);return}if(!X){Q("Encryption requires Web Crypto (HTTPS). Open this page over HTTPS."),V(!0),setTimeout(()=>V(!1),350);return}F(!0),Q(null);try{var t;let r=await g(W,e);K(null!=(t=r.molecule.title)?t:null,180),M(r.molecule),C({...r.style}),S(null),B(null)}catch(t){let e=(null==t?void 0:t.message)||"";/wrong password/i.test(e)?Q("Wrong password or data corrupted"):Q("Failed to decrypt"),V(!0),setTimeout(()=>V(!1),350)}finally{F(!1)}},[K,W,D,X]);return(0,n.useEffect)(()=>{try{window.scrollTo(0,0)}catch(e){}},[]),(0,a.jsxs)("main",{className:"fixed inset-0 w-screen h-[100dvh] overflow-hidden bg-white",children:[(0,a.jsx)(j.N,{children:W?(0,a.jsx)(U.P.div,{className:"absolute inset-0 z-[70]",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,a.jsx)("div",{className:"grid h-full w-full place-items-center bg-white/70 backdrop-blur",children:(0,a.jsxs)(U.P.div,{className:"w-[min(92vw,420px)] rounded-2xl bg-white/90 p-5 shadow-xl ring-1 ring-slate-200/80 backdrop-blur-md",initial:{y:18,opacity:0,scale:.98},animate:{y:0,opacity:1,scale:1},exit:{y:12,opacity:0,scale:.98},transition:{type:"spring",stiffness:260,damping:22},children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-sky-50 text-sky-600 ring-1 ring-sky-200",children:(0,a.jsx)(f.A,{className:"h-4 w-4"})}),(0,a.jsx)("h2",{className:"text-base font-semibold tracking-wide text-slate-900",children:"Encrypted"})]}),(0,a.jsx)("p",{className:"mt-1 text-sm text-slate-600",children:"Enter password to view."}),(0,a.jsxs)(U.P.div,{className:"mt-3 relative",animate:G?{x:[0,-6,6,-4,4,-2,2,0]}:{x:0},transition:{duration:.35,ease:"easeInOut"},children:[(0,a.jsx)("input",{type:"password",className:"h-9 w-full rounded-md bg-white/95 pl-2 pr-10 text-base text-slate-800 placeholder:text-slate-400 shadow-inner ring-1 focus:outline-none ".concat(I||G?"ring-rose-300":"ring-slate-200 focus:ring-sky-300"),placeholder:"Password",value:D,onChange:e=>{H(e.target.value),Q(null)},onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),eu())},disabled:_,"aria-invalid":!!I}),(0,a.jsx)("button",{type:"button","aria-label":"Decrypt",onClick:eu,disabled:_||D.trim().length<4||!X,className:"absolute right-1 top-1/2 -translate-y-1/2 inline-flex h-7 w-7 items-center justify-center rounded-md border border-slate-200 bg-white/90 text-slate-700 shadow-sm transition hover:border-sky-300 hover:text-sky-600 disabled:cursor-not-allowed disabled:opacity-60",children:_?(0,a.jsx)(x.A,{className:"h-4 w-4 animate-spin"}):(0,a.jsx)(U.P.span,{whileHover:{scale:1.02},whileTap:{scale:.96},className:"inline-flex",children:(0,a.jsx)(v,{className:"h-4 w-4"})})})]}),X||I?null:(0,a.jsx)("div",{className:"mt-2 text-xs text-amber-700",children:"Encryption/decryption requires a secure context. Please open this page over HTTPS."}),I?(0,a.jsx)("div",{className:"mt-2 text-xs text-rose-700",children:I}):null]})})}):null}),(null==R?void 0:R.title)?(0,a.jsx)("div",{className:"pointer-events-none fixed left-3 top-3 z-[65]",children:(0,a.jsx)("div",{className:"pointer-events-auto inline-flex max-w-[70vw] items-center gap-1 rounded-lg bg-white/70 px-2.5 py-1.5 text-sm text-slate-800 shadow-sm ring-1 ring-slate-200/80 backdrop-blur-md",children:(0,a.jsx)("span",{className:"truncate font-semibold tracking-wide",children:R.title})})}):null,h?(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center text-slate-500",children:"Decoding QR payload..."}):(0,a.jsx)(l.j,{molecule:R,style:L,onGroupReady:O,className:"h-[100dvh] w-screen rounded-none border-0"}),(0,a.jsxs)("div",{className:"pointer-events-none fixed inset-0 z-[60]",style:{paddingTop:"max(0px, env(safe-area-inset-top))",paddingRight:"max(0px, env(safe-area-inset-right))",paddingBottom:"max(0px, env(safe-area-inset-bottom))",paddingLeft:"max(0px, env(safe-area-inset-left))"},children:[(0,a.jsx)("div",{className:"pointer-events-auto fixed",style:{right:"max(1rem, env(safe-area-inset-right))",top:"max(1rem, env(safe-area-inset-top))"},children:(0,a.jsx)("button",{type:"button","aria-label":"Rendering Options",onClick:()=>T(e=>!e),disabled:!R,ref:z,className:"h-11 w-11 rounded-full text-slate-700 transition "+(P?"bg-transparent border border-transparent shadow-none hover:text-slate-700":"bg-white border border-slate-200 shadow-sm hover:border-sky-300 hover:text-sky-600")+" disabled:cursor-not-allowed disabled:opacity-60",children:P?(0,a.jsx)(b,{className:"mx-auto h-5 w-5"}):(0,a.jsx)(w,{className:"mx-auto h-5 w-5"})})}),(0,a.jsx)("div",{className:"pointer-events-auto fixed left-1/2 -translate-x-1/2",style:{bottom:"calc(env(safe-area-inset-bottom) + 2.25rem)"},children:(0,a.jsx)("button",{type:"button","aria-label":ea?"Preparing AR assets":"Open AR","aria-busy":ea,onClick:ed,disabled:!R||ea,className:"h-12 w-12 rounded-full border border-slate-200 bg-white text-slate-700 shadow-md transition hover:border-sky-300 hover:text-sky-600 disabled:cursor-not-allowed disabled:opacity-60",children:ea?(0,a.jsx)(x.A,{className:"mx-auto h-5 w-5 animate-spin"}):(0,a.jsx)(y,{className:"mx-auto h-5 w-5"})})}),(0,a.jsx)("div",{className:"pointer-events-none fixed select-none text-[10px] text-slate-400",style:{right:"max(0.5rem, env(safe-area-inset-right))",bottom:"max(0.5rem, calc(env(safe-area-inset-bottom) + 0.5rem))"},children:(0,a.jsxs)("div",{className:"pointer-events-auto inline-flex items-center gap-1 rounded-md bg-white/50 px-1.5 py-0.5 shadow-sm ring-1 ring-slate-200/50 backdrop-blur-sm",children:[(0,a.jsx)("span",{className:"opacity-80",children:"Powered by"}),(0,a.jsx)("a",{href:i.hn,target:"_blank",rel:"noreferrer",className:"font-medium text-slate-500 underline-offset-2 hover:text-sky-600 hover:underline",children:"MolStamp"})]})})]}),(0,a.jsx)("div",{ref:q,className:"fixed z-[55] w-[clamp(300px,86vw,360px)] transition-opacity duration-150 "+(P?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"),style:{right:"max(1rem, env(safe-area-inset-right))",top:"max(1rem, env(safe-area-inset-top))"},role:"dialog","aria-label":"Rendering Options","aria-hidden":!P,children:(0,a.jsx)(s.X,{value:L,onChange:C,disabled:!R})}),el?(0,a.jsx)("model-viewer",{ref:ei,style:{width:0,height:0,position:"absolute",opacity:0},src:null!=(e=null==Y?void 0:Y.url)?e:void 0,"ios-src":null!=(t=null==Z?void 0:Z.url)?t:void 0,ar:!0,"ar-modes":"webxr scene-viewer quick-look","camera-controls":!0,autoplay:!0}):null,et?(0,a.jsx)("div",{className:"absolute left-1/2 top-4 -translate-x-1/2 rounded bg-amber-50 px-3 py-1.5 text-xs text-amber-800 shadow ring-1 ring-amber-200",children:et}):null]})}},5775:(e,t,r)=>{Promise.resolve().then(r.bind(r,2119))}},e=>{e.O(0,[831,367,413,33,355,926,441,255,358],()=>e(e.s=5775)),_N_E=e.O()}]);